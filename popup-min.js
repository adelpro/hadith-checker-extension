import{getAllHadith,getAllHadithInfo}from"./utils/extractHadithInfo.js";const cards=document.getElementsByClassName("cards")[0],loader=document.getElementById("loader")[0],next=document.getElementById("next"),prev=document.getElementById("prev"),pageCounter=document.querySelector("#page-counter span"),hadithCounter=document.querySelector("#hadith-counter span"),shareButton=document.querySelectorAll("#share-button");let numberOfHadith,currPage=1,currText="";const searchForHadithByText=async(e,t=1)=>{const a=`https://dorar.net/dorar_api.json?skey=${e}&page=${t}`;return await convertToJSON(a)},convertToJSON=async e=>{try{const t=await fetch(encodeURI(e)),a=await t.json(),n=he.decode(a.ahadith.result),r=getAllHadith(n),s=getAllHadithInfo(n);return r.map(((e,t)=>({...e,...s[t]})))}catch(e){}},updateContent=e=>{const t=e.map((e=>{const{hadith:t,el_rawi:a,el_mohdith:n,source:r,number_or_page:s,grade:c}=e;return`<div class="card">\n             <p class="hadith-text">${t}</p>\n             <div class="hadith-info">\n                <p class="hadith-rawi"><span>الراوي:</span> ${a}</p>\n                <p class="hadith-mohdith"><span>المتحدث:</span> ${n}</p>\n                <p class="hadith-source"><span>المصدر:</span> ${r}</p>\n                <p class="hadith-number"><span>رقم الحديث أو الصفحة:</span> ${s}</p>\n                <p class="hadith-grade"><span>صحة الحديث:</span> ${c}</p>\n             </div>\n             <button id="share-button" data-hadith=${t}>\n             <svg aria-hidden="true" data-prefix="fal" data-icon="share-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="svg-inline--fa fa-share-square fa-w-18 fa-7x"><path fill="currentColor" d="M566.633 169.37L406.63 9.392C386.626-10.612 352 3.395 352 32.022v72.538C210.132 108.474 88 143.455 88 286.3c0 84.74 49.78 133.742 79.45 155.462 24.196 17.695 58.033-4.917 49.7-34.51C188.286 304.843 225.497 284.074 352 280.54V352c0 28.655 34.654 42.606 54.63 22.63l160.003-160c12.489-12.5 12.489-32.76 0-45.26zM384 352V248.04c-141.718.777-240.762 15.03-197.65 167.96C154.91 393 120 351.28 120 286.3c0-134.037 131.645-149.387 264-150.26V32l160 160-160 160zm37.095 52.186c2.216-1.582 4.298-3.323 6.735-5.584 7.68-7.128 20.17-1.692 20.17 8.787V464c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h172.146c6.612 0 11.954 5.412 11.852 12.04-.084 5.446-4.045 10.087-9.331 11.396-9.462 2.343-18.465 4.974-27.074 7.914-1.25.427-2.555.65-3.876.65H48c-8.837 0-16 7.163-16 16v352c0 8.837 7.163 16 16 16h352c8.837 0 16-7.163 16-16v-50.002c0-3.905 1.916-7.543 5.095-9.812z" class=""></path></svg>\n             <button>\n          </div>`}));cards.innerHTML=t.join("")},shareIt=e=>{e&&navigator.share({title:"Hadith checker",text:e,url:"./icons/icons128.png"})};shareButton.forEach((e=>{navigator.share||(e.style.display="none"),e.addEventListener("click",(()=>shareIt(e.dataset.hadith)))}));const updatePageCounter=()=>{pageCounter.innerText=currPage},updateHadithCounter=()=>{hadithCounter.innerText=numberOfHadith},showMessage=e=>{document.getElementById("message").innerHTML=e,updatePageCounter(),updateHadithCounter()};chrome.storage.local.get("text",(async({text:e})=>{loader.className="center";const t=await searchForHadithByText(e);if(currText=e,numberOfHadith=t.length,0===numberOfHadith)return loader.className="loader-head",void showMessage("<span>لا يوجد أي نتائج، حاول أن تحدد عدد كلمات أكثر</span><br/><span>أو أن تحدد نص عربي تعتقد أنه حديث</span>");updatePageCounter(),updateHadithCounter(),updateContent(t),loader.className="loader-head"})),next.addEventListener("click",(async e=>{e.preventDefault();const t=await searchForHadithByText(currText,currPage+1);0!==t.length?(currPage+=1,updateContent(t),updatePageCounter(),updateHadithCounter()):showMessage("<span>لا يوجد نتائج أُخرى</span>")})),prev.addEventListener("click",(async e=>{if(e.preventDefault(),1===currPage)return;currPage-=1;const t=await searchForHadithByText(currText,currPage);updateContent(t),updatePageCounter()})),document.getElementById("share-button").addEventListener("click",shareIt);